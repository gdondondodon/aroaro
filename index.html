<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>アロカスわからせ</title>
  
  <style>
    .center {
  text-align: center;
  }
  body {
  max-width: 600px;   /* 中央に置く幅 */
  margin: 0 auto;     /* 横方向の中央寄せ */
  padding: 20px;      /* 画面端と少し余白を作る */
  box-sizing: border-box;
  }

  /* 共通のデザイン */
  input, select, textarea {
    width: 100%;
    padding: 10px;
    font-size: 16px;
  }

  textarea {
    min-height: 120px;
  }

  #customBox {
    margin-top: 10px;
  }
  
  /* スマホ */
  @media (max-width: 599px) {
  input, select, textarea {
    font-size: 14px;
    padding: 8px;
  }

  #insertChoice {
    width: 100%;
  }

  #customInsert {
    width: 100%;
   }
  }

  /* タブレット */
  @media (min-width: 600px) and (max-width: 900px) {
  input, select, textarea {
    font-size: 16px;
    padding: 10px;
    }
  }

  /* PC */
  @media (min-width: 900px) {
    body {
    max-width: 600px;
    margin: 0 auto;    /* 画面の中央に寄せる */
    }

    input, select, textarea {
    font-size: 18px;
    padding: 12px;
    }

    #customBox {
    max-width: 400px;
    }
  }

  button {
    padding: 8px 14px;
    font-size: 16px;
    border-radius: 6px;
    border: none;
    background-color: #5e5e5e;
    color: white;
    cursor: pointer;
  }

  button:hover {
  background-color: #666;
  }

  @media (max-width: 600px) {
    button {
    padding: 7px 12px;
    font-size: 15px;
   }
  }

  @media (min-width: 900px) {
  button {
    padding: 9px 16px;
    font-size: 17px;
    }
  }

  #insertArea {
  display: flex;
  align-items: center;     /* 縦位置そろえる */
  gap: 10px;               /* すき間 */
  margin-bottom: 10px;
  }

  /* ★ select を短くする */
  #insertChoice {
  width: 120px;            /* ← 好きな幅に変えられる */
  padding: 6px;
  font-size: 14px;
  }

  /* 説明文のスタイル */
  .insertExplain {
  font-size: 14px;
  color: #555;
  }

  /*フィードバック用*/
  #feedbackBtn {
    position: fixed;
    right: 12px;
    bottom: 12px;
    padding: 8px 12px;
    font-size: 12px;
    border-radius: 999px;
    background-color: #000;
    color: #fff;
    border: none;
    cursor: pointer;
    opacity: 0.75;
    z-index: 1000;
    transition: opacity 0.2s ease, transform 0.2s ease;
  }

  #feedbackBtn:hover {
    opacity: 1;
    transform: scale(1.05);
  }

  /*コピーボタン*/
  #copy.copied {
    background-color: #4fc3f7; /*成功*/
    box-shadow: 0 0 0 2px rgba(79, 195, 247, 0.35);
  }
  #copy.failed {
    background-color: #e53935; /*失敗*/
    box-shadow: 0 0 0 2px rgba(229, 57, 53, 0.35);
  }


 </style>

</head>
<body>
  <h1 class="center">アロカスわからせ</h1>
  <h3></h3>
  <textarea id="inputText" placeholder="ここに文章を入力"></textarea>

  <br>
  <div id="insertArea">
  <select id="insertChoice">
    <option value=" ">半角スペース</option>
    <option value="/">/</option>
    <option value="、">、</option>
    <option value="custom">カスタム</option>
  </select>
  <span class="insertExplain">挿入する文字を選択</span>
  </div>

  <div id="customBox" style="display: none;">
    <input type="text" id="customInsert" placeholder="挿入する文字を入力"/>
  </div>

  <button id="clear">消す</button>

  <h3></h3>
  <textarea id="outputText" placeholder="ここに結果を出力"></textarea>
  <br>
  <button id="copy">コピー</button>
  <button id="feedbackBtn" onclick="openFeedbackTweet()">
  未対応のワード、不具合等はこちらへ
  </button>

  <script>

  //読み取り準備
  const outputText = document.getElementById("outputText");
  const clearButton = document.getElementById("clear");
  const copyButton = document.getElementById("copy");
  const inputText = document.getElementById("inputText");
  const customInsert = document.getElementById("customInsert");


  //伏せ字セット、変換文字数
  const arokasu = [
    /*001*/ "しな", /*002*/ "さんか", /*003*/ "れず", /*004*/ "らち", /*005*/ "くそ",
    /*006*/ "ばか", /*007*/ "花粉", /*008*/ "公式", /*009*/ "お知らせ", /*010*/ "サービス",
    /*011*/ "本番", /*012*/ "GM", /*013*/ "69", /*014*/ "6G", /*015*/ "えた",
    /*016*/ "訳あり", /*017*/ "たいま", /*018*/ "人権", /*019*/ "そうか", /*020*/ "しね",
    /*021*/ "合法", /*022*/ "社員", /*023*/ "矯正", /*024*/ "警察", /*025*/ "えっち", 
    /*026*/ "にだ", /*027*/ "くすこ", /*028*/ "とさつ", /*029*/ "アカウント", /*030*/ "しゃし",
    /*031*/ "げす", /*032*/ "かす", /*033*/ "挿入", /*034*/ "セキュリティ", /*035*/ "ぶっかけ", 
    /*036*/ "ちょん",/*037*/ "サプリ", /*038*/ "はげ", /*039*/ "うそこ", /*040*/ "企画", 
    /*041*/ "どじ", /*042*/ "ヒモ", /*043*/ "エミュ", /*044*/ "めくら", /*045*/ "どれい",
    /*046*/ "テロ", /*047*/ "糖質", /*048*/ "ツール", /*049*/ "ぼけ", /*050*/ "スタッフ", 
    /*051*/ "セガ", /*052*/ "デブ", /*053*/ "ハック", /*054*/ "チート", /*055*/ "独立", 
    /*056*/ "はだか", /*057*/ "殺す", /*058*/ "殺し", /*059*/ "殺さ", /*060*/ "殺せ",
    /*061*/ "殺そ", /*062*/ "ころす", /*063*/ "ころし", /*064*/ "ころさ", /*065*/ "ころせ", 
    /*066*/ "ころそ", /*067*/ "稼ぐ", /*068*/ "稼い", /*069*/ "稼が", /*070*/ "稼げ", 
    /*071*/ "稼ご", /*072*/ "であい", /*073*/ "出会", /*074*/ "みだら", /*075*/ "ぱんま",
    /*076*/ "雑魚", /*077*/ "ざこ", /*078*/ "無理やり", /*079*/ "無理矢理", /*080*/ "しゃいん", 
    /*081*/ "援助", /*082*/ "見放題", /*083*/ "ロボ", /*084*/ "サポート", /*085*/ "破産", 
    /*086*/ "生理", /*087*/ "あほ", /*088*/ "Hさ", /*089*/ "Hな", /*090*/ "Hに",
    /*091*/ "Hを", /*092*/ "ポーカー", /*093*/ "カジノ", /*094*/ "くんに", /*095*/ "jap",
    /*096*/ "タヒね", /*097*/ "万円", /*098*/ "外人", /*099*/"ゆうかい", /*100*/"むりやり",
    /*101*/ "Hし", /*102*/ "Hが", /*103*/ "サンバ", /*104*/ "競馬", /*105*/ "パチンコ",
    /*106*/ "クリニック", /*107*/ "ハッキング", /*108*/ "sc", /*109*/ "儲か", /*110*/ "儲け", 
    /*111*/ "にぐろ", /*112*/ "寄生虫", /*113*/ "キャッシ", /*114*/ "家出", /*115*/ "支払い",
    /*116*/ "毛髪", /*117*/ "鬼畜", /*118*/ "じさつ", /*119*/ "占い", /*120*/ "アナウンス",
    /*121*/ "メンヘラ", /*122*/ "あえる", /*123*/ "会える", /*124*/ "ぶらく", /*125*/ "だイベン",
    /*126*/ "感染", /*127*/ "お花畑", /*128*/ "歯科", /*129*/ "下着", /*130*/ "かんせん",
    /*131*/ "ちろう", /*132*/ "ヤンキー", /*133*/ "ガチンコ", /*134*/ "マンコラボ", /*135*/ "スピリチュアル",
    /*136*/ "パチスロ", /*137*/ "ロリコン", /*138*/ "決済", /*139*/ "性癖"
  ];


  const number = [
    /*001*/ "1", /*002*/ "2", /*003*/ "1", /*004*/ "1", /*005*/ "1", 
    /*006*/ "1", /*007*/ "1", /*008*/ "1", /*009*/ "2", /*010*/ "1", 
    /*011*/ "1", /*012*/ "1", /*013*/ "1", /*014*/ "1", /*015*/ "1",
    /*016*/ "1", /*017*/ "1", /*018*/ "1", /*019*/ "2", /*020*/ "1", 
    /*021*/ "1", /*022*/ "1", /*023*/ "1", /*024*/ "1", /*025*/ "1", 
    /*026*/ "1", /*027*/ "1", /*028*/ "1", /*029*/ "2", /*030*/ "2",
    /*031*/ "1", /*032*/ "1", /*033*/ "1", /*034*/ "3", /*035*/ "2", 
    /*036*/ "2", /*037*/ "2", /*038*/ "1", /*039*/ "1", /*040*/ "1", 
    /*041*/ "1", /*042*/ "1", /*043*/ "1", /*044*/ "1", /*045*/ "2",
    /*046*/ "1", /*047*/ "1", /*048*/ "1", /*049*/ "1", /*050*/ "1",
    /*051*/ "1", /*052*/ "1", /*053*/ "1", /*054*/ "2", /*055*/ "1",
    /*056*/ "1", /*057*/ "1", /*058*/ "1", /*059*/ "1", /*060*/ "1",
    /*061*/ "1", /*062*/ "1", /*063*/ "1", /*064*/ "1", /*065*/ "1",
    /*066*/ "1", /*067*/ "1", /*068*/ "1", /*069*/ "1", /*070*/ "1",
    /*071*/ "1", /*072*/ "1", /*073*/ "1", /*074*/ "1", /*075*/ "2",
    /*076*/ "1", /*077*/ "1", /*078*/ "2", /*079*/ "2", /*080*/ "2",
    /*081*/ "1", /*082*/ "1", /*083*/ "1", /*084*/ "1", /*085*/ "1",
    /*086*/ "1", /*087*/ "1", /*088*/ "1", /*089*/ "1", /*090*/ "1",
    /*091*/ "1", /*092*/ "2", /*093*/ "1", /*094*/ "2", /*095*/ "2",
    /*096*/ "2", /*097*/ "1", /*098*/ "1", /*099*/ "3", /*100*/ "2",
    /*101*/ "1", /*102*/ "1", /*103*/ "2", /*104*/ "1", /*105*/ "2",
    /*106*/ "3", /*107*/ "2", /*108*/ "1", /*109*/ "1", /*110*/ "1",
    /*111*/ "1", /*112*/ "2", /*113*/ "2", /*114*/ "1", /*115*/ "1",
    /*116*/ "1", /*117*/ "1", /*118*/ "1", /*119*/ "1", /*120*/ "2",
    /*121*/ "2", /*121*/ "1", /*121*/ "1", /*124*/ "2", /*125*/ "1",
    /*126*/ "1", /*127*/ "1", /*128*/ "1", /*129*/ "1", /*130*/ "2",
    /*131*/ "1", /*132*/ "2", /*133*/ "2", /*134*/ "2", /*135*/ "2",
    /*136*/ "2", /*137*/ "2", /*138*/ "1", /*139*/ "1"
  ];

  //無効化集
  const disabledWordsRaw = new Set(["しな", "さんか", "殺さ", "ころさ", "稼が", "稼ご", "無理矢理", "ロボ", "あえる"]);
  


  // 熟語置換
  const jukugoFrom = [
    "裸足", "全裸", "半裸", "裸体", "裸眼", "赤裸々", "赤裸裸", "素っ裸", "素裸", "真っ裸", "真裸", "裸族",
    "淫ら", "淫ラ"
  ];
  const jukugoTo   = [
    "ハダシ", "全ラ", "半ラ", "ラ体", "ラ眼", "赤ラ々", "赤ララ", "すっぱだか", "すっぱだか", "まっぱだか", "まっぱだか", "ラ族",
    "みだら", "ミダラ"
  ];

  //熟語変換後の単体対応
  const charFrom = ["死", "舐", "痴", "裸","淫", "咥", "辱"];      
  const charTo   = ["タヒ", "ナ", "チ", "ハダカ", "イン", "くわ", "ジョク"];

  // 隠しテキスト
  const specialInput = [
    "アリス",
    "ばにたす"
  ];

  const specialOutput = [
    "光よ──!",
    "ᓀ‸ᓂ"
  ];

  //エラー出力
  const error_text = "ちょっと！ダメな言葉が入ってるじゃない！\nエッチなのはダメ！死刑！";

  //フィードバックURL
  const FEEDBACK_POST_URL ="https://x.com/gododododon/status/2007152129358868693?s=20"; //ここにURL
  function openFeedbackTweet() {
     location.href = FEEDBACK_POST_URL;
  }



  //カスタム枠表示
  const select = document.getElementById("insertChoice");
  const customBox = document.getElementById("customBox");
  select.addEventListener("change", () => {
  if (select.value === "custom") {
    customBox.style.display = "block";  // 表示
   } 
  else {
    customBox.style.display = "none";   // 非表示
  }

  updateOutput(); // 変更を反映させる
});


  
  //関数作成

  //ひらがな->カタカナ関数
  function hTok(str){
    return str.replace(/[\u3041-\u3096]/g, function(ch){
      return String.fromCharCode(ch.charCodeAt(0) + 0x60);
    });
  }

  //正規化
  function normalizeForCheck(s) {
    return hTok(String(s || "")).toLowerCase();
  }

  //カスタム挿入文字
  function getUserInsert(){
    const select = document.getElementById("insertChoice");
    const custom = document.getElementById("customInsert");

    if (select.value === "custom") {
      return custom.value;
    }
    else{
      return select.value;
    }
  }

  //漢字変換
  function applyCharReplace(str) {

   //熟語置換
    const pairs = jukugoFrom
      .map((f, i) => [f, jukugoTo[i]])
      .sort((a,b) => b[0].length - a[0].length);

    for (const [from, to] of pairs) {
      str = str.split(from).join(to);
    }

   //単体置換
    for (let i = 0; i < charFrom.length; i++) {
      const from = charFrom[i];
      const to   = charTo[i];
      str = str.split(from).join(to);
    }

    return str;
  }

  //無効化
  const disabledWords = new Set([...disabledWordsRaw].map(normalizeForCheck));
  function isDisabledWord(word) {
    return disabledWords.has(normalizeForCheck(word));
  }

  function getActiveArokasu() {
    return arokasu.filter(w => !isDisabledWord(w));
  }


  //挿入関数
  function insertAt(str, pos, insertStr) {
    return str.slice(0, pos) + insertStr + str.slice(pos);
  }

  //処理関数
  function applyRuleOnce(str, aro, num, ins){

    //カタカナ化
    let norm = hTok(str).toLowerCase();
    const arok = hTok(aro).toLowerCase();
    const pos = Number(num); //数値化

    //ループ
    let start = 0;
    while (true){
      const idx = norm.indexOf(arok, start)
      if (idx === -1) break;

      const insertPos = idx + pos; //aroのnum番目

      str = insertAt(str, insertPos, ins); //元の文
      norm = insertAt(norm, insertPos, ins); //判定用
      start = insertPos + ins.length
    }

    return str;
  }

  //挿入NG判定
  function isInsertNg(insertStr) {
    const ins = normalizeForCheck(insertStr);
    if (ins.length === 0) return false;
    
    const keys = [
      ...getActiveArokasu(),
      ...(typeof jukugoFrom !== "undefined" ? jukugoFrom : []),
      ...charFrom
    ];

    for (const k of keys) {
      const key = normalizeForCheck(k);
      if (key && ins.includes(key)) {
        return true;
      }
   }
    return false;
  }

  //挿入後NG
  function containsForbidden(str) {
    const s = normalizeForCheck(str);
    if (s.length === 0) return false;

    const keys = [
      ...getActiveArokasu(),
      ...(typeof jukugoFrom !== "undefined" ? jukugoFrom : []),
      ...charFrom
    ];

    for (const k of keys) {
      const key = normalizeForCheck(k);
      if (!key) continue;
      if (s.includes(key)) return true;
    }
    return false;
  }



  //隠しテキスト判定
  function applySpecialMapping(inputStr) {
    const s = normalizeForCheck(inputStr);

    for (let i = 0; i < specialInput.length; i++) {
      if (s === normalizeForCheck(specialInput[i])) {
        return specialOutput[i];
      }
    }
    return null;
  }


  //変換処理関数
  function updateOutput() {

    //配列ズレ
    if (arokasu.length !== number.length) {
      outputText.value = "うへ～、arokasu配列の個数が合ってないよ～";
      return;
    }

    if (jukugoFrom.length !== jukugoTo.length) {
      outputText.value = "うへ～、jukugo配列の個数が合ってないよ～";
      return;
    }

    if (charFrom.length !== charTo.length) {
      outputText.value = "うへ～、char配列の個数が合ってないよ～";
      return;
    }

    if (specialInput.length !== specialOutput.length) {
      outputText.value = "うへ～、special配列の個数が合ってないよ～";
      return;
    }

    let raw = inputText.value;
    raw = applyCharReplace(raw);
    const userInsert = getUserInsert();

    // 隠し出力
    const special = applySpecialMapping(userInsert);
    if (special !== null) {
      outputText.value = special;
      return;
    }

    //伏せ字矛盾
    if (isInsertNg(userInsert)) {
       outputText.value = error_text;
       return;
    }

    //通常変換
    for(let i = 0; i <arokasu.length; i++){
      const aro = arokasu[i];
      if (isDisabledWord(aro)) continue;
      raw = applyRuleOnce(raw, aro, number[i], userInsert);
    }

    //置換後エラー
    if (containsForbidden(raw) && userInsert !== "") {
      outputText.value = error_text;
      return;
   }

    //結果出力
    outputText.value = raw;
  };

  //入力時変更
  inputText.addEventListener("input", () => {
    updateOutput();
  });

  //選択肢変更
  const insertChoice = document.getElementById("insertChoice");
  insertChoice.addEventListener("change", () => {
    updateOutput();
  });

  //カスタム挿入変更
  customInsert.addEventListener("input", updateOutput);


  //コピーボタン
  copyButton.addEventListener("click", async (e) => {
  copyButton.classList.remove("copied", "failed");

    try {
      await navigator.clipboard.writeText(outputText.value);
      copyButton.classList.add("copied");
    } catch (err) {
      copyButton.classList.add("failed");
      console.error(err);
    }

    setTimeout(() => {
      copyButton.classList.remove("copied", "failed");
    }, 900);
  });

   

  //デリートボタン
  clearButton.addEventListener("click", () => {
   inputText.value = "";
   outputText.value = "";
   });

</script>
</body>
</html>

